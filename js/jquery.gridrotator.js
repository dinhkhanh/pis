(function(e,t,n){"use strict";Array.prototype.shuffle=function(){var e=this.length,t,n;while(e--){t=Math.floor(Math.random()*e);n=this[e];this[e]=this[t];this[t]=n}return this};var r=e.event,i,s;i=r.special.debouncedresize={setup:function(){e(this).on("resize",i.handler)},teardown:function(){e(this).off("resize",i.handler)},handler:function(e,t){var n=this,o=arguments,u=function(){e.type="debouncedresize";r.dispatch.apply(n,o)};if(s){clearTimeout(s)}t?u():s=setTimeout(u,i.threshold)},threshold:50};var o=e(t),u=t.Modernizr;e.GridRotator=function(t,n){this.$el=e(n);if(u.backgroundsize){var r=this;this.$el.addClass("ri-grid-loading");e("<img/>").load(function(){r._init(t)}).attr("src","http://www.dinhkhanh.dk/wp-content/uploads/2012/11/inf-loading-1033263719.gif")}};e.GridRotator.defaults={rows:4,columns:10,w1024:{rows:2,columns:5},w768:{rows:2,columns:5},w480:{rows:2,columns:5},w320:{rows:2,columns:5},w240:{rows:2,columns:5},step:"random",maxStep:3,preventClick:true,animType:"random",animSpeed:500,animEasingOut:"linear",animEasingIn:"linear",interval:3e3};e.GridRotator.prototype={_init:function(t){var n=this;this.options=e.extend(true,{},e.GridRotator.defaults,t);this.animTypesAll=["fadeInOut","slideLeft","slideRight","slideTop","slideBottom","rotateLeft","rotateRight","rotateTop","rotateBottom","scale","rotate3d","rotateLeftScale","rotateRightScale","rotateTopScale","rotateBottomScale"];this.animTypesCond=["fadeInOut","slideLeft","slideRight","slideTop","slideBottom"];this.animTypes=this.animTypesCond;if(u.csstransforms3d){this.animTypes=this.animTypesAll}this.animType=this.options.animType;if(this.animType!=="random"){if(!u.csstransforms3d&&e.inArray(this.animType,this.animTypesCond)===-1&&this.animType!=="showHide"){this.animType="fadeInOut"}}this.animTypesTotal=this.animTypes.length;this.$list=this.$el.children("ul");var r=0,i=this.$list.find("img"),s=i.length;i.each(function(){var t=e(this),o=t.attr("src");e("<img/>").load(function(){++r;t.parent().css("background-image","url("+o+")");if(r===s){i.remove();n.$el.removeClass("ri-grid-loading");n.$items=n.$list.children("li");n.$itemsCache=n.$items.clone();n.itemsTotal=n.$items.length;n.outItems=[];n._layout();n._initEvents();n._start()}}).attr("src",o)})},_layout:function(t){var n=this;this._setGridDim();this.$list.empty();this.$items=this.$itemsCache.clone().appendTo(this.$list);var r=this.$items.filter(":gt("+(this.showTotal-1)+")"),i=r.children("a");this.outItems.length=0;i.each(function(t){n.outItems.push(e(this))});r.remove();var s=document.defaultView?parseInt(document.defaultView.getComputedStyle(this.$el.get(0),null).width):this.$el.width(),o=Math.floor(s/this.columns),u=s-this.columns*Math.floor(o);for(var a=0;a<this.rows;++a){for(var f=0;f<this.columns;++f){var l=this.$items.eq(this.columns*a+f),c=o,h=f<Math.floor(u)?o+1:o;l.css({width:h-1,height:c-1})}}if(this.options.preventClick){this.$items.children().css("cursor","default").on("click.gridrotator",false)}if(t){t.call()}},_setGridDim:function(){var e=this.$el.width();switch(true){case e<240:this.rows=this.options.w240.rows;this.columns=this.options.w240.columns;break;case e<320:this.rows=this.options.w320.rows;this.columns=this.options.w320.columns;break;case e<480:this.rows=this.options.w480.rows;this.columns=this.options.w480.columns;break;case e<768:this.rows=this.options.w768.rows;this.columns=this.options.w768.columns;break;case e<1024:this.rows=this.options.w1024.rows;this.columns=this.options.w1024.columns;break;default:this.rows=this.options.rows;this.columns=this.options.columns;break}this.showTotal=this.rows*this.columns},_initEvents:function(){var e=this;o.on("debouncedresize.gridrotator",function(t){clearTimeout(e.playtimeout);e._layout(function(){e._start()})})},_start:function(){if(this.showTotal<this.itemsTotal){this._showNext()}},_getAnimType:function(){if(this.animType==="random"){return this.animTypes[Math.floor(Math.random()*this.animTypesTotal)]}else{return this.animType}},_getAnimProperties:function(e,t){var r={},i={},s={},o={},u=this._getAnimType(),a;switch(u){case"showHide":a=0;o.opacity=0;break;case"fadeInOut":o.opacity=0;break;case"slideLeft":r.left=t.width();s.left=0;o.left=-t.width();break;case"slideRight":r.left=-t.width();s.left=0;o.left=t.width();break;case"slideTop":r.top=t.height();s.top=0;o.top=-t.height();break;case"slideBottom":r.top=-t.height();s.top=0;o.top=t.height();break;case"rotateLeft":a=this.options.animSpeed/2;r.rotateY="90deg";s.rotateY="0deg";s.delay=a;o.rotateY="-90deg";break;case"rotateRight":a=this.options.animSpeed/2;r.rotateY="-90deg";s.rotateY="0deg";s.delay=a;o.rotateY="90deg";break;case"rotateTop":a=this.options.animSpeed/2;r.rotateX="90deg";s.rotateX="0deg";s.delay=a;o.rotateX="-90deg";break;case"rotateBottom":a=this.options.animSpeed/2;r.rotateX="-90deg";s.rotateX="0deg";s.delay=a;o.rotateX="90deg";break;case"scale":a=this.options.animSpeed/2;r.scale="0";i.scale="1";s.scale="1";s.delay=a;o.scale="0";break;case"rotateLeftScale":r.scale="0.3";i.scale="1";s.scale="1";o.scale="0.3";a=this.options.animSpeed/2;r.rotateY="90deg";s.rotateY="0deg";s.delay=a;o.rotateY="-90deg";break;case"rotateRightScale":r.scale="0.3";i.scale="1";s.scale="1";o.scale="0.3";a=this.options.animSpeed/2;r.rotateY="-90deg";s.rotateY="0deg";s.delay=a;o.rotateY="90deg";break;case"rotateTopScale":r.scale="0.3";i.scale="1";s.scale="1";o.scale="0.3";a=this.options.animSpeed/2;r.rotateX="90deg";s.rotateX="0deg";s.delay=a;o.rotateX="-90deg";break;case"rotateBottomScale":r.scale="0.3";i.scale="1";s.scale="1";o.scale="0.3";a=this.options.animSpeed/2;r.rotateX="-90deg";s.rotateX="0deg";s.delay=a;o.rotateX="90deg";break;case"rotate3d":a=this.options.animSpeed/2;r.rotate3d="1, 1, 0, 90deg";s.rotate3d="1, 1, 0, 0deg";s.delay=a;o.rotate3d="1, 1, 0, -90deg";break}var f=a!=n?a:this.options.animSpeed;return{startInProp:r,startOutProp:i,endInProp:s,endOutProp:o,animSpeed:f}},_showNext:function(t){var n=this;clearTimeout(this.playtimeout);this.playtimeout=setTimeout(function(){var t=n.options.step,r=n.options.maxStep,i=1;if(r>n.showTotal){r=n.showTotal}var s=n.$items,o=[],a=t==="random"?Math.floor(Math.random()*r+i):Math.min(Math.abs(t),r),f=n._getRandom(a,n.showTotal);for(var l=0;l<a;++l){var c=s.eq(f[l]);if(c.data("active")){n._showNext(1);return false}o.push(c)}for(var l=0;l<a;++l){var c=o[l],h=c.children("a:last"),p={width:h.width(),height:h.height()};c.data("active",true);var d=n.outItems.shift();n.outItems.push(h.clone());d.css(p).prependTo(c);var v=n._getAnimProperties(d,h);if(u.csstransitions){d.css(v.startInProp).transition(v.endInProp,v.animSpeed,n.options.animEasingIn);h.css(v.startOutProp).transition(v.endOutProp,v.animSpeed,n.options.animEasingOut,function(){e(this).parent().data("active",false).end().remove()})}else{d.css(v.startInProp).stop().animate(v.endInProp,v.animSpeed);h.css(v.startOutProp).stop().animate(v.endOutProp,v.animSpeed,function(){e(this).parent().data("active",false).end().remove()})}}n._showNext()},t||Math.max(Math.abs(this.options.interval),300))},_getRandom:function(e,t){var n=[];for(var r=0;r<t;++r){n.push(r)}return n.shuffle().slice(0,e)}};var a=function(e){if(t.console){t.console.error(e)}};e.fn.gridrotator=function(t){if(typeof t==="string"){var n=Array.prototype.slice.call(arguments,1);this.each(function(){var r=e.data(this,"gridrotator");if(!r){a("cannot call methods on gridrotator prior to initialization; "+"attempted to call method '"+t+"'");return}if(!e.isFunction(r[t])||t.charAt(0)==="_"){a("no such method '"+t+"' for gridrotator instance");return}r[t].apply(r,n)})}else{this.each(function(){var n=e.data(this,"gridrotator");if(n){n._init()}else{e.data(this,"gridrotator",new e.GridRotator(t,this))}})}return this}})(jQuery,window)